ninja_required_version = 1.7.2

rule gn
  command = python3 ../../buildtools/platform/gn.py --root=../.. -q --regeneration gen .
  pool = console
  description = Regenerating ninja files

# The 'gn' rule also writes build.ninja, unbeknownst to ninja. The
# build.ninja edge is separate to prevent ninja from deleting it
# (due to depfile usage) if interrupted. gn uses atomic writes to
# ensure that build.ninja is always valid even if interrupted.
build build.ninja.stamp: gn
  generator = 1
  depfile = build.ninja.d

build build.ninja: phony build.ninja.stamp
  generator = 1

pool build_toolchain_action_pool
  depth = 72

pool build_toolchain_link_pool
  depth = 30

subninja toolchain.ninja

build all: phony $
  obj/base/libbase.a $
  ./base_unittests

default all
