<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>cr-audit-commits Status Page</title>
  <style type="text/css"/>
body {
  font-family: Roboto, Arial, sans-serif;
}
td {
  vertical-align: top;
  padding: 10px;
}

h3 {
  text-align: center;
  font-size: 28px;
}

table {
  margin: 0 auto;
}

table table {
  margin: 0;
}

table table td{
  border-bottom: 1px solid #DDDDDD;
}

.red-status{
  color: #9A2617;
  font-weight: bold;
}
.green-status{
  color: #829356;
}

.message{
  color: #0C374D;
  font-size: 12px;
  font-family: monospace;

}

.section {
  margin: 20px auto;
  padding: 20px;
  background: linear-gradient(to bottom right, #DCE5F8, #FFFFFF);
  max-width: 1500px;
  box-shadow: 1px 1px 5px #888888;
  border-radius: 20px;
}
  </style>
</head>

<body>
<div class="section">
<h3>Monitored Repositories</h3>
<table>
<tr>
<th> Name </th>
<th> URL </th>
<th> Alerts </th>
{{range $k, $v := .RuleMap}}
<tr>
<td>{{$k}}</td>
<td><a href="{{$v.RepoURL}}">{{$v.RepoURL}}</a></td>
<td><a href="https://bugs.chromium.org/p/{{$v.MonorailProject}}/issues/list?can=1&q={{$v.AlertsQuery}}">Monorail link</a></td>
</tr>
{{end}}
</table>
</div>

<div class="section">
<h3>Status for {{.RepoName}}</h3>
<table><tr>
{{if .LastRelevant}}
<td> Last Interesting Commit
<a href="{{.BaseRepoURL}}/+/{{.LastRelevant}}">{{printf "%.8s" .LastRelevant}}</a>
  {{if not .LastRelevantTime.IsZero}} 
    ({{.LastRelevantTime | timeAgo}})
  {{end}}
</td>
{{end}}
{{if .LastScanned}}
<td> Last Scanned Commit
<a href="{{.BaseRepoURL}}/+/{{.LastScanned}}">{{printf "%.8s" .LastScanned}}</a>
  {{if not .LastScannedTime.IsZero}} 
    ({{.LastScannedTime | timeAgo}})
  {{end}}
</td>
{{end}}
</tr></table>
</div>

{{if .Commits}}
<div class="section">
<h3>Most recent audited commits for {{.RepoName}}</h3>
<table>
  <tr>
    <th>Commit</th>
    <th>Commit time</th>
    <th>Status</th>
  </tr>
  {{$repo := .BaseRepoURL}}
  {{range .Commits}}
    <tr>
      <td width="350">
        <a href="{{$repo}}/+/{{.CommitHash}}">
          {{printf "%.8s" .CommitHash}}
          {{commitSubject .CommitMessage}}
        </a>
      </td>
      <td width="200">{{.CommitTime | timeAgo}}</td>
      <td>
        <table>
          <tr><td align="center" class="{{.Status.ColorCode}}" colspan="3">
            {{.Status.ToString}}
          </td></tr>
          {{range .Result}}
            <tr>
            <td>{{.RuleName}}</td>
            <td class="{{.RuleResultStatus.ColorCode}}" width="400">{{.RuleResultStatus.ToString}}
              {{if .Message}}
                <p class="message">{{.Message}}</p>
              {{end}}
            </td>
            </tr>
          {{end}}
        </table>
      </td>
    </tr>
  {{end}}
</table>
</div>
{{end}}

<body>
  </html>
