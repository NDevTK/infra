<!DOCTYPE html>
<title>statusTableTest</title>
<meta charset="utf-8">
<link rel="import" href="/elements/status-table.html">
<script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<script src="/bower_components/web-component-tester/browser.js"></script>

<test-fixture id="table-test">
  <template>
    <status-table></status-table>
  </template>
</test-fixture>

<script>
  'use strict';

  suite('status-table', function() {
    var element;
    const baseDateTs = 1498114800000; // 22/06/2017 PTZ
    setup(function(){
      element = fixture('table-test');
      element.latestDateTs = baseDateTs;

      let service = {name: 'Monorail'}
      service.incidents = [
        {
          severity: 'RED',
          startTime: '1497693923',
          endTime: '1497787570',
        },{
          severity: 'YELLOW',
          startTime: '1497693723',
          endTime: '1497787520',
        },{
          severity: 'YELLOW',
          startTime: '1497693723',
          endTime: '1497787590',
        },
      ];

      let serviceTwo = {name: 'Sheriff-O-Matic'}
      serviceTwo.incidents = [
        {
          severity: 'YELLOW',
          startTime: '1497653923',
          endTime: '1497799570',
        },{
          severity: 'RED',
          startTime: '1497773923',
          endTime: '1497787570',
        },
      ];

      let serviceThree = {name: 'Code Search'}
      serviceThree.incidents = [
        {
          severity: 'YELLOW',
          startTime: '1497653923',
          endTime: '1497799570',
        },{
          severity: 'YELLOW',
          startTime: '1497773923',
          open: 'true',
        },
      ];

      element.push('services', service, serviceTwo, serviceThree);

    });

    test('test elements created', function(done) {
      flush(function () {
        let prettyDates = [
          "2017-6-16", "2017-6-17", "2017-6-18",
          "2017-6-19", "2017-6-20", "2017-6-21", "2017-6-22"
        ]
        element.formattedDates.forEach((prettyDate, i) => {
          assert.equal(prettyDate, prettyDates[i]);
        });
        element.dates.reverse().forEach((date, i) => {
          let ts = new Date(baseDateTs);
          assert.equal(ts.setDate(ts.getDate() -i), date.getTime());
        });
        done();
      });

    });
  });
</script>
