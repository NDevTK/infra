plans:
    - name: servo
      criticalactions:
        - name: Set state:MISSING_CONFIG ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Servo is know in the setup ('dut_servo_host_present') (RUN_ONCE)
          dependencies:
            - name: Set state:WRONG_CONFIG ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Servod port specified ('servo_servod_port_present') (RUN_ONCE)
          dependencies:
            - name: Set state:WRONG_CONFIG ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Servo serial is specified ('dut_servo_has_serial') (RUN_ONCE)
          dependencies:
            - name: Set state:WRONG_CONFIG ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Initialize docker container ('servo_host_servod_init') (time:'6m0s')
          conditions:
            - name: Uses servod container ('servo_uses_servod_container')
          dependencies:
            - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
          dependencies:
            - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
        - name: Mark labstation as servod is in-use ('cros_create_servo_in_use')
          conditions:
            - name: Is labstation ('servo_host_is_labstation')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:SERVO_HOST_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Read release info (Allow to fail) ('cros_run_command') (RUN_ONCE)
          conditions:
            - name: Servod container is not used ('servo_uses_servod_container')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:SERVO_HOST_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Power-cycle by smart-hub (Allow to fail) ('servo_power_cycle_root_servo') (RUN_ONCE) (time:'2m0s')
          conditions:
            - name: DUT is not SSHable ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
        - name: Has enough free disk space ('cros_has_enough_storage_space')
          conditions:
            - name: Servod container is not used ('servo_uses_servod_container')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:BROKEN ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Remove logs and other files ('sample_pass')
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: servo_labstation_disk_cleanup
                - name: Remove logs older 5 days ('servo_servod_old_logs_cleanup')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Cache latest servod start time (Allow to fail) ('cros_register_servod_logs_start')
          conditions:
            - name: Servod container is not used ('servo_uses_servod_container')
        - name: Servo_v4(p1) main present ('servo_v4_root_present')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:NOT_CONNECTED ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Recover servo with Power-cycle by smart-hub ('servo_power_cycle_root_servo') (ALWAYS_RUN) (time:'2m0s')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: All servo's fw updated ('servo_fw_need_update') (time:'5m0s')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:SERVO_UPDATER_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
            - name: Update all servo's firmware ('servo_update_servo_firmware') (RUN_ONCE) (time:'10m0s')
              dependencies:
                - name: Stop servod daemon on servo-host ('servo_host_servod_init') (time:'6m0s')
        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
          dependencies:
            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Start servod daemon ('servo_host_servod_init') (time:'2m0s')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:SERVO_HOST_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Stop servod and request to use recovery-mode for servod ('sample_pass') (RUN_ONCE)
              dependencies:
                - name: Specify to use REC_MODE=1 for servo ('servo_create_flag_to_use_recovery_mode') (RUN_ONCE)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
                - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                  conditions:
                    - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
              dependencies:
                - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Start UART capture (Allow to fail) ('servod_start_uart_capture')
        - name: Servod is responsive to dut-control ('servo_servod_echo_host') (time:'30s')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:SERVOD_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod and request to use recovery-mode for servod ('sample_pass') (RUN_ONCE)
              dependencies:
                - name: Specify to use REC_MODE=1 for servo ('servo_create_flag_to_use_recovery_mode') (RUN_ONCE)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Read servo serial by servod harness ('servod_echo')
          dependencies:
            - name: Set state:SERVOD_PROXY_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
            - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
                - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                  conditions:
                    - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
              dependencies:
                - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Set cold_reset for c2d2 (Allow to fail) ('servo_set')
          conditions:
            - name: Servo used c2d2 ('servo_type_regex_match')
        - name: Verify servo connected to the DUT ('servo_low_ppdut5')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Is servo_v4(p1) with type-a connector ('servo_check_servod_control')
            - name: DUT has CrOS EC ('servo_check_servod_control')
          dependencies:
            - name: Set state:DUT_NOT_CONNECTED ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Power cycle by RPM with delay and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_micro
                - name: RPM config present ('device_has_rpm_info')
              dependencies:
                - name: Set RPM OFF ('device_rpm_power_off') (ALWAYS_RUN)
                - name: Sleep 35s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                - name: Set RPM ON ('device_rpm_power_on') (ALWAYS_RUN)
                - name: Try Cold reset by servod (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Force reflash servo_micro fw and stop ('sample_pass')
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
                - name: is_servo_micro
                - name: Is ok to force update servo_micro firmware ('sample_fail')
                  conditions:
                    - name: Last servo_micro fw updated within 2 weeks ('metrics_found_at_last_time')
              dependencies:
                - name: Force update servo_micro firmware ('servo_update_servo_firmware') (time:'3m0s')
                  conditions:
                    - name: Is labstation ('servo_host_is_labstation')
                    - name: is_servo_micro
                    - name: Is ok to force update servo_micro firmware ('sample_fail')
                      conditions:
                        - name: Last servo_micro fw updated within 2 weeks ('metrics_found_at_last_time')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Debug header servo present ('servo_check_servod_control')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Servo uses debug header components ('servo_has_debug_header')
          dependencies:
            - name: Set state:DEBUG_HEADER_SERVO_MISSING ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Cold reset pin is detected ('servo_check_servod_control')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Is servo_v4(p1) with type-a connector ('servo_check_servod_control')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:COLD_RESET_PIN_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Warm reset pin is detected (servo_micro) (Allow to fail) ('servo_check_servod_control')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: is_servo_micro
            - name: Warm reset control known by servo ('servo_check_servod_control')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
            - name: Set state:WARM_RESET_PIN_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Charger connected (Allow to fail) ('servo_control_min_double_value')
          conditions:
            - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
            - name: Has ppchg5_mv control ('servod_has')
          dependencies:
            - name: Read ppdut5_mv value ('servo_check_servod_control')
            - name: Read ppchg5_mv value ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Set state:SERVOD_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Power on DUT by RPM ('rpm_power_on')
              conditions:
                - name: has_rpm_info
        - name: Check if PD is src state (Allow to fail) ('servo_check_servod_control')
          conditions:
            - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
            - name: Has ppchg5_mv control ('servod_has')
          dependencies:
            - name: Set state:SERVOD_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Read ppdut5_mv value ('servo_check_servod_control')
            - name: Read ppchg5_mv value ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Charger connected (Allow to fail) ('servo_control_min_double_value')
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                - name: Has ppchg5_mv control ('servod_has')
              dependencies:
                - name: Read ppdut5_mv value ('servo_check_servod_control')
                - name: Read ppchg5_mv value ('servo_check_servod_control')
                  recoveries:
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Set state:SERVOD_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Power on DUT by RPM ('rpm_power_on')
                  conditions:
                    - name: has_rpm_info
          recoveries:
            - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
        - name: Verify CCD GSC connection detected ('sample_pass')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Servo main device is CCD ('servo_main_device_is_ccd')
              dependencies:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
          dependencies:
            - name: Set state:SBU_LOW_VOLTAGE ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Servo SBU voltage is good ('servo_cr50_low_sbu')
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                - name: Servod detect voltage issue ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
                  conditions:
                    - name: Is labstation ('servo_host_is_labstation')
                  dependencies:
                    - name: cros_create_reboot_request
            - name: Set state:CR50_NOT_ENUMERATED ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Servo Cr50 enumerated ('sample_fail')
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                - name: Servod detect voltage issue ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Servod detect all children components ('servo_check_servod_control')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Set state:SERVOD_DUT_CONTROLLER_MISSING ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
            - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
                - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                  conditions:
                    - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
              dependencies:
                - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is labstation ('servo_host_is_labstation')
              dependencies:
                - name: cros_create_reboot_request
        - name: Servo topology ('sample_pass')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Servo topology min one child ('servo_topology_update')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                  recoveries:
                    - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
                - name: Set state:TOPOLOGY_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
                  conditions:
                    - name: Is labstation ('servo_host_is_labstation')
                  dependencies:
                    - name: cros_create_reboot_request
            - name: Servo topology min two children ('servo_topology_update')
              conditions:
                - name: is_dual_setup ('is_dual_setup_configured')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                  recoveries:
                    - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
                - name: Set state:TOPOLOGY_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Create request to reboot labstation ('sample_fail') (ALWAYS_RUN)
                  conditions:
                    - name: Is labstation ('servo_host_is_labstation')
                  dependencies:
                    - name: cros_create_reboot_request
        - name: Update USB drive info (Allow to fail) ('servo_update_usbkey_history')
          dependencies:
            - name: Verify that USB drive is detectable (Allow to fail) ('servo_usbkey_is_detected')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                  recoveries:
                    - name: Wait for labstation to load ('cros_ssh') (time:'2m0s')
              recoveries:
                - name: Recover servo with Power-cycle by smart-hub ('servo_power_cycle_root_servo') (ALWAYS_RUN) (time:'2m0s')
        - name: Initialize DUT part for servo ('init_dut_for_servo') (time:'2m0s')
          dependencies:
            - name: Set state:BROKEN ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Set main servo device ('servod_set_main_device')
              conditions:
                - name: Servod knows about active_dut_controller control ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Open gsc testlab (Allow to fail) ('servo_set') (ALWAYS_RUN)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
                  dependencies:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Reset CCD to factory settings (Allow to fail) ('servo_set') (ALWAYS_RUN)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
                  dependencies:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
            - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
                - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                  conditions:
                    - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
              dependencies:
                - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Verify cr50 console ('servod_can_read_all')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
              dependencies:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Initialize DUT part for servo ('init_dut_for_servo') (time:'2m0s')
              dependencies:
                - name: Set state:BROKEN ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Set main servo device ('servod_set_main_device')
                  conditions:
                    - name: Servod knows about active_dut_controller control ('servo_check_servod_control')
                  recoveries:
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                    - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                      conditions:
                        - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                      dependencies:
                        - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                          conditions:
                            - name: is_servo_type_ccd
                        - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                          dependencies:
                            - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                              dependencies:
                                - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                    - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                        - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                          dependencies:
                            - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                              dependencies:
                                - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                    - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                        - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                          dependencies:
                            - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                              dependencies:
                                - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                    - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                        - name: is_servo_type_ccd
                      dependencies:
                        - name: cros_reset_ec (ALWAYS_RUN)
                          dependencies:
                            - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                        - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                          dependencies:
                            - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                              dependencies:
                                - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Open gsc testlab (Allow to fail) ('servo_set') (ALWAYS_RUN)
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Reset CCD to factory settings (Allow to fail) ('servo_set') (ALWAYS_RUN)
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                      conditions:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Set state:CR50_CONSOLE_MISSING ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
            - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
              conditions:
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
                - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                  conditions:
                    - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
              dependencies:
                - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: is_servo_type_ccd
              dependencies:
                - name: cros_reset_ec (ALWAYS_RUN)
                  dependencies:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reset GSC from DUT and stop servod ('sample_pass') (RUN_ONCE)
              conditions:
                - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
              dependencies:
                - name: Reset GSC on DUT (Allow to fail) ('cros_run_command') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Cr50 testlab is enabled ('servo_check_servod_control')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Is not in cr50 pools ('dut_not_in_pool_regex')
            - name: Expected CCD factory settings ('servo_ccd_expect_have_factory_reset')
              dependencies:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Set state:CCD_TESTLAB_ISSUE ('servo_set_servo_state') (ALWAYS_RUN)
          recoveries:
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: is_servo_type_ccd
              dependencies:
                - name: Try fake disconnect ('servo_fake_disconnect_dut')
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
        - name: Verify EC ('sample_pass')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: DUT has CrOS EC ('servo_check_servod_control')
          dependencies:
            - name: Set state:EC_BROKEN ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Verify EC console ('servod_can_read_all')
              conditions:
                - name: DUT has CrOS EC ('servo_check_servod_control')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Set state:BAD_RIBBON_CABLE ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Verify power button signal (Allow to fail) ('servo_check_servod_control')
              conditions:
                - name: pwr_button_supported_models ('dut_check_model') (RUN_ONCE)
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot servo device ('servo_reboot') (RUN_ONCE) (time:'1m10s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Set state:NO_SSH ('servo_set_servo_state') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle DTS Mode and Servo Role ('servo_servod_dts_and_servo_role_toggle_exec') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                - name: Toggle PD once and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle PD once ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle PD (5 times) and stop ('servo_host_servod_stop') (ALWAYS_RUN)
                  conditions:
                    - name: Is servo_v4(p1) used with type-c connector ('servo_check_servod_control')
                  dependencies:
                    - name: Toggle PD 5 times ('servo_servod_toggle_pd_role') (ALWAYS_RUN)
                - name: Try fake disconnect and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: Try fake disconnect ('servo_fake_disconnect_dut')
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Toggle CC line and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Toggle CC lines ('servo_servod_cc_toggle') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Force reflash servo_micro fw and stop ('sample_pass')
                  conditions:
                    - name: Is labstation ('servo_host_is_labstation')
                    - name: is_servo_micro
                    - name: Is ok to force update servo_micro firmware ('sample_fail')
                      conditions:
                        - name: Last servo_micro fw updated within 2 weeks ('metrics_found_at_last_time')
                  dependencies:
                    - name: Force update servo_micro firmware ('servo_update_servo_firmware') (time:'3m0s')
                      conditions:
                        - name: Is labstation ('servo_host_is_labstation')
                        - name: is_servo_micro
                        - name: Is ok to force update servo_micro firmware ('sample_fail')
                          conditions:
                            - name: Last servo_micro fw updated within 2 weeks ('metrics_found_at_last_time')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Set state:LID_OPEN_FAILED ('servo_set_servo_state') (ALWAYS_RUN)
            - name: Is lid open (Allow to fail) ('servod_lidopen')
              recoveries:
                - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                  dependencies:
                    - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                      dependencies:
                        - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reboot by EC console and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Reboot by DUT's EC UART ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Cold reset the DUT by servod and stop ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Cold reset by servod ('servo_power_state_reset') (ALWAYS_RUN)
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reflash Cr50 fw and stop ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                    - name: Is reflash Cr50 was done more 24 hours ago ('sample_fail')
                      conditions:
                        - name: Is reflash Cr50 was done within 24 hours ('metrics_found_at_last_time')
                  dependencies:
                    - name: Reflash Cr50 fw on DUT ('cros_reflash_cr50_fw') (RUN_ONCE) (time:'2m30s')
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
                - name: Reset EC from DUT and stop ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: is_servo_type_ccd
                  dependencies:
                    - name: cros_reset_ec (ALWAYS_RUN)
                      dependencies:
                        - name: DUT is SSHable ('cros_ssh_dut') (ALWAYS_RUN) (time:'15s')
                    - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
                      dependencies:
                        - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                          dependencies:
                            - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
            - name: Verify battery by servo (Allow to fail) ('servo_battery_charging')
              conditions:
                - name: DUT has CrOS EC ('servo_check_servod_control')
                - name: battery_last_charge_readable ('servo_check_servod_control')
        - name: Record good servo type ('servo_update_servo_type_label')
          dependencies:
            - name: Set state:BROKEN ('servo_set_servo_state') (ALWAYS_RUN)
        - name: Set state:WORKING ('servo_set_servo_state') (ALWAYS_RUN)
    - name: cros
      criticalactions:
        - name: 'Set state: needs_deploy (''dut_set_state'') (RUN_ONCE)'
        - name: Check stable versions exist ('sample_pass')
          conditions:
            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
          dependencies:
            - name: Recovery version has OS image path ('has_stable_version_cros_image')
              dependencies:
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Check stable firmware version exists ('has_stable_version_fw_version')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
        - name: Download stable version OS image to servo usbkey if necessary ('sample_pass')
          conditions:
            - name: Setup has servo info ('dut_servo_host_present')
            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Stable version image is missing from servo usbkey ('sample_fail')
              conditions:
                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
          dependencies:
            - name: servo_servod_echo_host
            - name: Is servo USB key detected ('servo_usbkey_is_detected')
              dependencies:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
        - name: Device is pingable before deploy ('cros_ping') (time:'15s')
          recoveries:
            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
            - name: Power cycle DUT by RPM and wait ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: RPM config present ('device_has_rpm_info')
              dependencies:
                - name: rpm_power_cycle
                - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                - name: Try cold reset DUT by servo (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
        - name: DUT is on test channel OS ('cros_is_os_test_channel')
          dependencies:
            - name: Device is pingable before deploy ('cros_ping') (time:'15s')
              recoveries:
                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                - name: Power cycle DUT by RPM and wait ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: RPM config present ('device_has_rpm_info')
                  dependencies:
                    - name: rpm_power_cycle
                    - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                    - name: Try cold reset DUT by servo (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
            - name: Device NOT booted from USB-drive ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Device booted from USB-drive ('cros_booted_from_external_storage') (ALWAYS_RUN)
              recoveries:
                - name: Set default boot as disk and reboot ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Set default boot as disk ('cros_update_crossystem')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
          recoveries:
            - name: Quick provision OS ('sample_pass')
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode with fresh image ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
        - name: Collect firmware target (Allow to fail) ('cros_collect_firmware_target') (ALWAYS_RUN)
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Is crosid readable ('cros_run_command')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Is crosid present ('cros_run_command')
              recoveries:
                - name: Repair by Reboot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Remove whitelabel_tag from vpd and reboot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Delete whitelabel_tag from vpd ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
          recoveries:
            - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
            - name: Quick provision OS ('sample_pass')
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
        - name: DUT has correct cros image version ('cros_is_on_stable_version')
          conditions:
            - name: Is it first deployment task ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
            - name: Recovery version has OS image path ('has_stable_version_cros_image')
              dependencies:
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
          recoveries:
            - name: Quick provision OS ('sample_pass')
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode with fresh image ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode, with force to DEV-mode with test firmware ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Flash EC (FW) by servo ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
        - name: Set dev_boot_usb is enabled (Allow to fail) ('cros_update_crossystem') (RUN_ONCE)
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: DUT has expected dev firmware ('cros_has_dev_signed_firmware') (time:'10m0s')
          conditions:
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Device not in MP Signed AP FW pool ('dut_not_in_pool')
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
          recoveries:
            - name: Update DUT firmware with factory mode and restart by servo ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Collect HWID into inventory ('sample_pass') (RUN_ONCE)
                  dependencies:
                    - name: Read HWID from DUT ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                      conditions:
                        - name: Not Satlab device ('sample_fail')
                          conditions:
                            - name: Is Satlab device ('dut_regex_name_match')
                    - name: Read HWID from DUT (Satlab) (Allow to fail) ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Try to update FW from firmware image with factory mode (Allow to fail) ('cros_update_firmware_from_firmware_image') (ALWAYS_RUN) (time:'2h0m0s')
                  conditions:
                    - name: has_stable_version_fw_image
                - name: Try to update FW from OS image with factory mode (Allow to fail) ('cros_run_firmware_update') (ALWAYS_RUN) (time:'15m0s')
                  conditions:
                    - name: Missing stable fw image ('sample_fail')
                      conditions:
                        - name: has_stable_version_fw_image
                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Update DUT firmware with factory mode and restart by host ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Collect HWID into inventory ('sample_pass') (RUN_ONCE)
                  dependencies:
                    - name: Read HWID from DUT ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                      conditions:
                        - name: Not Satlab device ('sample_fail')
                          conditions:
                            - name: Is Satlab device ('dut_regex_name_match')
                    - name: Read HWID from DUT (Satlab) (Allow to fail) ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Try to update FW from firmware image with factory mode (Allow to fail) ('cros_update_firmware_from_firmware_image') (ALWAYS_RUN) (time:'2h0m0s')
                  conditions:
                    - name: has_stable_version_fw_image
                - name: Try to update FW from OS image with factory mode (Allow to fail) ('cros_run_firmware_update') (ALWAYS_RUN) (time:'15m0s')
                  conditions:
                    - name: Missing stable fw image ('sample_fail')
                      conditions:
                        - name: has_stable_version_fw_image
                - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: DUT has expected firmware version ('sample_pass') (ALWAYS_RUN)
          conditions:
            - name: Is it first deployment task ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Collect HWID into inventory ('sample_pass') (RUN_ONCE)
              dependencies:
                - name: Read HWID from DUT ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                  conditions:
                    - name: Not Satlab device ('sample_fail')
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                - name: Read HWID from DUT (Satlab) (Allow to fail) ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                  conditions:
                    - name: Is Satlab device ('dut_regex_name_match')
            - name: Device not in MP Signed AP FW pool ('dut_not_in_pool')
            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Check stable firmware version exists ('has_stable_version_fw_version')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
              dependencies:
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: DUT has expected RO firmware version ('cros_is_on_ro_firmware_stable_version') (ALWAYS_RUN)
              recoveries:
                - name: Fix FW on the DUT to match stable-version and wait to boot ('sample_pass')
                  dependencies:
                    - name: Fix FW on the DUT to match stable-version (Allow to fail) ('cros_update_firmware_from_firmware_image') (time:'2h0m0s')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Provision OS if needed ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: DUT not on stable version ('cros_not_on_stable_version')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: DUT has expected RW firmware version ('cros_is_on_rw_firmware_stable_version') (ALWAYS_RUN)
              recoveries:
                - name: Fix FW on the DUT to match stable-version and wait to boot ('sample_pass')
                  dependencies:
                    - name: Fix FW on the DUT to match stable-version (Allow to fail) ('cros_update_firmware_from_firmware_image') (time:'2h0m0s')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Provision OS if needed ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: DUT not on stable version ('cros_not_on_stable_version')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: Deployment checks ('sample_pass')
          conditions:
            - name: Not Satlab device ('sample_fail')
              conditions:
                - name: Is Satlab device ('dut_regex_name_match')
            - name: Is it first deployment task ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
          dependencies:
            - name: Verify battery charging level ('cros_battery_changable_to_expected_level') (time:'2h30m0s')
              conditions:
                - name: Is not in audio box ('sample_fail')
                  conditions:
                    - name: dut_is_in_audio_box
                - name: Battery is expected on device ('dut_has_battery')
                - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
              dependencies:
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Verify boot in recovery mode ('cros_install_in_recovery_mode') (time:'25m0s')
              dependencies:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Verify RPM config ('sample_pass')
              conditions:
                - name: 'RPM set state: MISSING_CONFIG (''set_rpm_state'')'
                - name: RPM config present ('device_has_rpm_info')
                - name: Not a Dolos pool ('dut_not_in_pool')
              dependencies:
                - name: Audit RPM config (with battery) ('rpm_audit_with_battery') (time:'10m0s')
                  conditions:
                    - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
                  dependencies:
                    - name: 'RPM set state: WRONG_CONFIG (''set_rpm_state'')'
                - name: Audit RPM config (without battery) ('rpm_audit_without_battery') (time:'10m0s')
                  conditions:
                    - name: No Battery is present on device ('sample_fail')
                      conditions:
                        - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
                  dependencies:
                    - name: 'RPM set state: WRONG_CONFIG (''set_rpm_state'')'
            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: Collect DUT labels ('sample_pass')
          dependencies:
            - name: Collect HWID into inventory ('sample_pass') (RUN_ONCE)
              dependencies:
                - name: Read HWID from DUT ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                  conditions:
                    - name: Not Satlab device ('sample_fail')
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                - name: Read HWID from DUT (Satlab) (Allow to fail) ('cros_update_hwid_to_inventory') (ALWAYS_RUN)
                  conditions:
                    - name: Is Satlab device ('dut_regex_name_match')
            - name: Read DUT serial-number from DUT ('cros_update_serial_number_inventory') (ALWAYS_RUN)
              conditions:
                - name: Not Satlab device ('sample_fail')
                  conditions:
                    - name: Is Satlab device ('dut_regex_name_match')
            - name: Read DUT serial-number from DUT (Satlab) (Allow to fail) ('cros_update_serial_number_inventory') (ALWAYS_RUN)
              conditions:
                - name: Is Satlab device ('dut_regex_name_match')
            - name: Read device SKU (Allow to fail) ('cros_update_device_sku')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: dut_does_not_have_device_sku ('sample_fail')
                  conditions:
                    - name: dut_has_device_sku
            - name: servo_type_label (Allow to fail) ('servo_update_servo_type_label')
            - name: Read RO_VPD from DUT ('cros_update_ro_vpd_inventory')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Collect cellular labels (Allow to fail) ('sample_pass')
              conditions:
                - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
              dependencies:
                - name: Update cellular modem labels ('cros_update_cellular_modem_labels') (RUN_ONCE)
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: has_cellular_info
                  dependencies:
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update cellular sim labels ('cros_update_cellular_sim_labels') (RUN_ONCE) (time:'6m0s')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: has_cellular_info
                    - name: Is not starfish device ('carrier_not_in') (RUN_ONCE)
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                  dependencies:
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: cros_has_only_one_sim_profile
        - name: DUT verify ('sample_pass')
          dependencies:
            - name: Has repair-request for re-image USB-key ('dut_has_any_repair_requests')
              recoveries:
                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
            - name: Has repair-request for re-image by USB-key ('dut_has_any_repair_requests')
              recoveries:
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (with FW update) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                  dependencies:
                    - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Device is pingable ('cros_ping') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: DUT has board info ('dut_has_board_name') (RUN_ONCE)
                - name: DUT has model info ('dut_has_model_name') (RUN_ONCE)
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Pulse GSC_RST_L with servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: servo_has_debug_header
                    - name: Servo is not C2D2 ('is_servo_c2d2')
                    - name: Has gsc_reset control ('servod_has')
                  dependencies:
                    - name: Assert GSC_RST_L by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has gsc_reset control ('servod_has')
                    - name: Sleep 1 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'2s')
                    - name: Deassert GSC_RST_L by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has gsc_reset control ('servod_has')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Reset servo_v4.1 ethernet and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: is_servo_v4p1_by_serial_number
                  dependencies:
                    - name: Reset servo_v4.1 ethernet power ('servo_v4p1_network_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Power cycle DUT by RPM and wait ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: RPM config present ('device_has_rpm_info')
                  dependencies:
                    - name: rpm_power_cycle
                    - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                    - name: Try cold reset DUT by servo (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                - name: Trigger kernel panic to reset the whole board and try ssh to DUT ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Trigger kernel panic by servod ('servo_trigger_kernel_panic')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Restore AC detection by EC console and wait for ping ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo recover AC power ('servo_recover_ac_power') (time:'10m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: DUT has CrOS EC ('servo_check_servod_control')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: cros_is_battery_expected
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Battery cut-off by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: is_servo_type_ccd
                    - name: DUT is G3/S5 powerstate ('servo_power_state_match') (ALWAYS_RUN)
                  dependencies:
                    - name: Battery cut-off by servo EC console ('servo_set_ec_uart_cmd') (ALWAYS_RUN)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Try fake disconnect ('servo_fake_disconnect_dut') (ALWAYS_RUN)
                      conditions:
                        - name: is_servo_type_ccd
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Check if request labstation reboot ('sample_fail')
                  conditions:
                    - name: Check if servo is not connected by hub ('servo_not_connected_by_hub')
                  dependencies:
                    - name: Create request to reboot labstation ('labstation_create_reboot_request') (RUN_ONCE)
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Device Uptime (Allow to fail) ('cros_uptime_print')
            - name: Read bootId ('cros_read_bootid')
              recoveries:
                - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
            - name: Verify internal storage ('sample_pass')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Kernel does not know issues ('cros_has_critical_kernel_error')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Stateful partition has enough free index nodes ('cros_has_enough_index_nodes')
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Stateful partition has enough free space ('cros_has_enough_storage_space')
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Stateful partition (encrypted) has enough free space ('cros_has_enough_storage_space')
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Set dev_boot_usb is enabled (Allow to fail) ('cros_update_crossystem') (RUN_ONCE)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Verify if booted from priority kernel ('cros_kernel_priority_has_not_changed')
              conditions:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Simple reboot to right kernel ('cros_kernel_priority_has_not_changed')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Verify rootfs is on fs-verity ('cros_verify_rootfs_verity') (ALWAYS_RUN)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                  dependencies:
                    - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Check KVM is enabled (Allow to fail) ('cros_run_command') (time:'15s')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Has repair-request for re-provision ('dut_has_any_repair_requests')
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (with FW update) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                  dependencies:
                    - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Check if last provision was good ('cros_is_last_provision_successful')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Read OS version ('cros_read_os_version')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (with FW update) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                  dependencies:
                    - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Python is present ('cros_has_python_interpreter_working')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Read OS version ('cros_read_os_version')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Verify that device is not enrolled (Allow to fail) ('cros_is_enrollment_in_clean_state')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Cleanup the enrollment state and wait for boot (Allow to fail) ('cros_enrollment_cleanup') (time:'10m0s')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
            - name: Check power sources ('sample_pass')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: cros_is_not_virtual_machine
              dependencies:
                - name: Power is recognized by DUT ('cros_is_ac_power_connected')
                  recoveries:
                    - name: Power cycle DUT by RPM and wait ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: RPM config present ('device_has_rpm_info')
                      dependencies:
                        - name: rpm_power_cycle
                        - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                        - name: Try cold reset DUT by servo (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Battery is changing or have accepted level ('cros_is_battery_chargable_or_good_level')
                  conditions:
                    - name: cros_is_battery_expected
                    - name: cros_is_not_virtual_machine
                    - name: Battery is expected on device ('dut_has_battery')
                    - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
                  recoveries:
                    - name: Recover by disabling factory settings ('sample_pass')
                      conditions:
                        - name: Device without cros EC ('dut_check_board') (RUN_ONCE)
                        - name: Battery is expected on device ('dut_has_battery')
                        - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
                      dependencies:
                        - name: Disable factory settings on the DUT ('cros_run_command')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Shutdown DUT by SSH ('cros_run_command')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Set RPM OFF ('device_rpm_power_off') (ALWAYS_RUN)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Set RPM ON ('device_rpm_power_on') (ALWAYS_RUN)
                        - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                    - name: Power cycle DUT by RPM and wait ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: RPM config present ('device_has_rpm_info')
                      dependencies:
                        - name: rpm_power_cycle
                        - name: Set servo PD to src (Allow to fail) ('servo_set') (ALWAYS_RUN)
                        - name: Try cold reset DUT by servo (Allow to fail) ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Check TPM statuses ('cros_is_tpm_in_good_status')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: cros_is_not_virtual_machine
                - name: cros_is_tpm_present
              recoveries:
                - name: ChromeOS TMP recovery (not critical) (Allow to fail) ('cros_run_shell_command')
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Repair by powerwash ('sample_pass')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Read TPM ownership (Allow to fail) ('cros_run_command')
              conditions:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Is hwsec-ownership-id expected ('cros_is_on_expected_version')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
            - name: Verify tpm_fwver is updated correctly ('cros_match_dev_tpm_firmware_version')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: ChromeOS TMP recovery (not critical) (Allow to fail) ('cros_run_shell_command')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Repair by powerwash ('sample_pass')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Verify tpm_kernver is updated correctly ('cros_match_dev_tpm_kernel_version')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: ChromeOS TMP recovery (not critical) (Allow to fail) ('cros_run_shell_command')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Verify present of gsctool (Allow to fail) ('cros_run_shell_command')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: DUT has Cr50 phase label ('dut_has_cr50')
              dependencies:
                - name: Read OS version ('cros_read_os_version')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Repair by powerwash ('sample_pass')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Audit battery (Allow to fail) ('cros_audit_battery')
              conditions:
                - name: cros_is_battery_expected
                - name: cros_is_not_virtual_machine
                - name: Battery is expected on device ('dut_has_battery')
                - name: Battery is present on device ('cros_is_battery_present') (ALWAYS_RUN)
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Battery temperature below threshold (Allow to fail) ('servo_check_servod_control')
            - name: Audit storage (SMART only) (Allow to fail) ('cros_audit_storage_smart')
            - name: Audit wifi (Allow to fail) ('cros_audit_wifi')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Audit bluetooth (Allow to fail) ('cros_audit_bluetooth')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Audit cellular (Allow to fail) ('sample_pass')
              conditions:
                - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
              dependencies:
                - name: Audit cellular modem (Allow to fail) ('sample_pass')
                  dependencies:
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update cellular sim labels if missing ('sample_pass')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: has_cellular_info
                    - name: Is not starfish device ('carrier_not_in') (RUN_ONCE)
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                    - name: cros_sim_info_empty
                  dependencies:
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update cellular sim labels ('cros_update_cellular_sim_labels') (RUN_ONCE) (time:'6m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                        - name: Is not starfish device ('carrier_not_in') (RUN_ONCE)
                          conditions:
                            - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                            - name: has_cellular_info
                      dependencies:
                        - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                          conditions:
                            - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                            - name: cros_has_mmcli
                            - name: has_cellular_info
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                              recoveries:
                                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                                  conditions:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                  dependencies:
                                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Set fw_wp_state to force_off ('servo_set')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                      dependencies:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Reset power using servo if booted from USB ('sample_pass')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: cros_has_only_one_sim_profile
                - name: Update cellular modem labels if missing ('sample_pass')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: has_cellular_info
                    - name: cros_imei_empty
                  dependencies:
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update cellular modem labels ('cros_update_cellular_modem_labels') (RUN_ONCE)
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                      dependencies:
                        - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                          conditions:
                            - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                            - name: cros_has_mmcli
                            - name: has_cellular_info
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                              recoveries:
                                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                                  conditions:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                  dependencies:
                                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Set fw_wp_state to force_off ('servo_set')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                      dependencies:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Reset power using servo if booted from USB ('sample_pass')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Audit cellular network connection (Allow to fail) ('cros_audit_cellular_connection') (time:'3m0s')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: cros_has_mmcli
                    - name: has_cellular_info
                    - name: Has live carrier ('carrier_not_in') (RUN_ONCE)
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                        - name: has_cellular_info
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Cellular modem is not in failed state ('cros_modem_state_not_in')
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: cros_has_mmcli
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Cellular modem is up ('cros_audit_cellular_modem') (time:'3m0s')
                          conditions:
                            - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                            - name: cros_has_mmcli
                            - name: has_cellular_info
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                              recoveries:
                                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                                  conditions:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                  dependencies:
                                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                          dependencies:
                                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Set fw_wp_state to force_off ('servo_set')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                      conditions:
                                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                      dependencies:
                                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                              dependencies:
                                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                                  dependencies:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                      conditions:
                                                        - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                                          conditions:
                                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                      dependencies:
                                        - name: servo_servod_echo_host
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                      dependencies:
                                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                      conditions:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                      dependencies:
                                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Reset power using servo if booted from USB ('sample_pass')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Audit cellular starfish (Allow to fail) ('cros_audit_cellular_starfish')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: Is starfish device ('carrier_is_in') (RUN_ONCE)
                      conditions:
                        - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                        - name: has_cellular_info
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Collect additional cellular labels (Allow to fail) ('cros_collect_supported_carriers')
                  conditions:
                    - name: Is in cellular pool ('dut_is_in_pool_regex') (RUN_ONCE)
                    - name: has_cellular_info
                - name: Collect var/log/messages from DUT (Allow to fail) ('cros_copy_to_logs') (RUN_ONCE)
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Collect var/log/net.log from DUT (Allow to fail) ('cros_copy_to_logs') (RUN_ONCE)
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Audit cellular modem on non-cellular pools (Allow to fail) ('cros_audit_cellular_modem') (time:'3m0s')
              conditions:
                - name: Is in non-cellular pool that runs cellular tests ('dut_is_in_pool_regex') (RUN_ONCE)
                - name: cros_has_mmcli
                - name: has_cellular_info
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Stop if DUT needs replacement ('dut_state_match')
              recoveries:
                - name: Place PROVISION repair-requests ('dut_add_repair_requests') (ALWAYS_RUN)
            - name: Firmware validations ('sample_pass')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Device not in MP Signed AP FW pool ('dut_not_in_pool')
              dependencies:
                - name: Ensure firmware is in good state ('cros_is_firmware_in_good_state')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Fix FW on the DUT to match stable-version and wait to boot ('sample_pass')
                      dependencies:
                        - name: Fix FW on the DUT to match stable-version (Allow to fail) ('cros_update_firmware_from_firmware_image') (time:'2h0m0s')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                          dependencies:
                            - name: Provision OS if needed ('sample_pass')
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: DUT not on stable version ('cros_not_on_stable_version')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: RO Firmware version matches the recovery-version (Allow to fail) ('cros_is_on_ro_firmware_stable_version')
                  conditions:
                    - name: Check stable firmware version exists ('has_stable_version_fw_version')
                      conditions:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Pools required to manage FW on the device ('dut_not_in_pool')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Fix FW on the DUT to match stable-version and wait to boot ('sample_pass')
                      dependencies:
                        - name: Fix FW on the DUT to match stable-version (Allow to fail) ('cros_update_firmware_from_firmware_image') (time:'2h0m0s')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                          dependencies:
                            - name: Provision OS if needed ('sample_pass')
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: DUT not on stable version ('cros_not_on_stable_version')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Verify servo keyboard firmware (Allow to fail) ('cros_run_shell_command')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: is_servo_keyboard_image_tool_present ('cros_is_tool_present')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: servo_init_usb_keyboard ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: lufa_keyboard_found ('cros_run_shell_command')
                  recoveries:
                    - name: Flash keyboard map (Allow to fail) ('cros_run_shell_command')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: set_at_hwb_on ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: set_atmega_rst_on ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep for atmega reset (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                        - name: set_atmega_rst_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep for atmega reset (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                        - name: set_at_hwb_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep for usb present delay (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                        - name: Check if expected Atmel chip ('cros_run_shell_command') (time:'30s')
                        - name: Transfer keyboard hex ('transfer_keyboard_hex')
                        - name: Erase keyboard map ('cros_run_shell_command') (time:'2m0s')
                        - name: Write keyboard map ('cros_run_shell_command') (time:'2m0s')
            - name: Check if OS on required version for camerabox tablet ('is_camerabox_tablet_on_os_version')
              conditions:
                - name: is_camerabox_tablet_pool ('dut_is_in_pool')
              dependencies:
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Read OS version ('cros_read_os_version')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Repair by powerwash ('sample_pass')
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                      dependencies:
                        - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
              recoveries:
                - name: provision camerabox tablet ('provision_camerabox_tablet') (time:'1h0m0s')
            - name: Check audio latency toolkit state (Allow to fail) ('cros_update_audio_latency_toolkit_state')
            - name: Login UI is up ('cros_stop_start_ui') (time:'45s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Repair by powerwash ('sample_pass')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Can list RW VPD Keys ('cros_can_list_rw_vpd_keys')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              recoveries:
                - name: Recover from RW VPD keys listing errors ('sample_pass')
                  dependencies:
                    - name: Provision OS if needed ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: DUT not on stable version ('cros_not_on_stable_version')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Erase RW VPD Keys ('cros_run_shell_command')
                    - name: Restore RW VPD Keys ('cros_restore_rw_vpd_keys')
                    - name: Check RW VPD Keys (Allow to fail) ('cros_are_required_rw_vpd_keys_present')
                      conditions:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Verify keys of RW_VPD (Allow to fail) ('cros_are_required_rw_vpd_keys_present')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              recoveries:
                - name: Restore RW VPD Keys ('cros_restore_rw_vpd_keys')
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Repair by powerwash ('sample_pass')
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Set VPD region:us (Allow to fail) ('cros_set_vpd_value')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Check VPD has value for stable_device_secret_DO_NOT_SHARE (Allow to fail) ('cros_check_vpd_value')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              recoveries:
                - name: Set random stable device secret (Allow to fail) ('cros_set_random_ro_vpd_stable_device_secret')
            - name: Verify RO_VPD sku_number (Allow to fail) ('cros_verify_ro_vpd_sku_number')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: RO_VPD sku_number is required ('cros_is_ro_vpd_sku_number_required')
              recoveries:
                - name: Set fake RO_VPD sku_number (Allow to fail) ('cros_set_fake_ro_vpd_sku_number')
            - name: Verify RO_VPD dsm_calib (Allow to fail) ('cros_verify_ro_vpd_dsm_calib')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: RO_VPD dsm_calib is required ('cros_is_ro_vpd_dsm_calib_required')
              recoveries:
                - name: Set fake RO_VPD dsm_calib (Allow to fail) ('cros_set_fake_ro_vpd_dsm_calib')
            - name: Verify RO_VPD data on DUT ('cros_match_ro_vpd_inventory')
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Restore RO_VPD on DUT ('cros_set_ro_vpd')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
            - name: Verify system info ('sample_pass')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Default boot set as internal storage ('cros_is_default_boot_from_disk')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Set default boot as disk ('cros_update_crossystem')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Restore HWID from inventory ('cros_match_hwid_to_inventory')
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Set HWID of the DUT from inventory ('cros_update_hwid_from_inventory_to_host') (time:'4m0s')
                          dependencies:
                            - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Verify that DUT is not in DEV mode ('cros_is_not_in_dev_mode')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Pools required to be in Secure mode ('sample_fail')
                      conditions:
                        - name: Pools allowed to stay in DEV mode ('dut_is_in_pool')
                  dependencies:
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          recoveries:
                            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                              conditions:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                              dependencies:
                                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                      dependencies:
                                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Set fw_wp_state to force_off ('servo_set')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                                  conditions:
                                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                                  dependencies:
                                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                          dependencies:
                                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                              dependencies:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                                  conditions:
                                                    - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                                      conditions:
                                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                                  dependencies:
                                    - name: servo_servod_echo_host
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                                  dependencies:
                                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                                  conditions:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                  dependencies:
                                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Reset power using servo if booted from USB ('sample_pass')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Quick provision OS ('sample_pass')
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Repair by powerwash ('sample_pass')
                          conditions:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                          dependencies:
                            - name: Write factory-install-reset to file system (Allow to fail) ('cros_run_shell_command')
                            - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                            - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                  recoveries:
                    - name: Switch to secure-mode and reboot ('sample_pass')
                      conditions:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Pools required to be in Secure mode ('sample_fail')
                          conditions:
                            - name: Pools allowed to stay in DEV mode ('dut_is_in_pool')
                        - name: Is not booted in secure mode (condition) ('sample_fail') (ALWAYS_RUN)
                          conditions:
                            - name: Booted in secure mode (condition) ('cros_is_booted_in_secure_mode') (ALWAYS_RUN)
                      dependencies:
                        - name: Reset GBB flags by host (Allow to fail) ('cros_set_gbb_flags') (time:'3m0s')
                          dependencies:
                            - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Disables booting into DEV-mode (Allow to fail) ('cros_switch_to_secure_mode')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Missing HWID ('sample_fail')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Not Satlab device ('sample_fail')
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                    - name: Read OS version ('cros_read_os_version')
                      dependencies:
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is HWID empty ('sample_fail') (ALWAYS_RUN)
                      conditions:
                        - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                  dependencies:
                    - name: 'Set state: needs_deploy (''dut_set_state'') (RUN_ONCE)'
                - name: Missing serial-number ('sample_fail')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Not Satlab device ('sample_fail')
                      conditions:
                        - name: Is Satlab device ('dut_regex_name_match')
                    - name: Read OS version ('cros_read_os_version')
                      dependencies:
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is serial-number empty ('sample_fail') (ALWAYS_RUN)
                      conditions:
                        - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
                  dependencies:
                    - name: 'Set state: needs_deploy (''dut_set_state'') (RUN_ONCE)'
                - name: Match HWID (Allow to fail) ('cros_match_hwid_to_inventory')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Read OS version ('cros_read_os_version')
                      dependencies:
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                  recoveries:
                    - name: Restore HWID from inventory ('cros_match_hwid_to_inventory')
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Set HWID of the DUT from inventory ('cros_update_hwid_from_inventory_to_host') (time:'4m0s')
                          dependencies:
                            - name: Disable software-controlled write-protect for 'internal' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                            - name: Disable software-controlled write-protect for 'ec' (Allow to fail) ('cros_disable_fprom_write_protect') (ALWAYS_RUN) (time:'5m0s')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Match serial-number (Allow to fail) ('cros_match_serial_number_inventory')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Read OS version ('cros_read_os_version')
                      dependencies:
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
                  recoveries:
                    - name: Restore serial-number ('cros_restore_serial_number')
            - name: Collect firmware target (Allow to fail) ('cros_collect_firmware_target') (ALWAYS_RUN)
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Is crosid readable ('cros_run_command')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is crosid present ('cros_run_command')
                  recoveries:
                    - name: Repair by Reboot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Quick provision OS ('sample_pass')
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Internal storage is responsive ('cros_is_file_system_writable')
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      dependencies:
                        - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                        - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Remove whitelabel_tag from vpd and reboot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Delete whitelabel_tag from vpd ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                          dependencies:
                            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
              recoveries:
                - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Collect gpu_id (Allow to fail) ('cros_collect_gpu_id') (ALWAYS_RUN)
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Update Servo NIC mac address (Allow to fail) ('servo_audit_nic_mac_address')
              conditions:
                - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: servod_control_exist_for_mac_address ('servo_check_servod_control')
                  conditions:
                    - name: Setup has servo info ('dut_servo_host_present')
            - name: Backup CBI (Allow to fail) ('cros_backup_cbi')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: CBI is present ('cros_cbi_is_present')
                - name: UFS does not contain CBI contents ('cros_ufs_does_not_contain_cbi_contents')
              dependencies:
                - name: CBI contents are valid ('cros_cbi_contents_are_valid') (ALWAYS_RUN)
                  dependencies:
                    - name: CBI is present ('cros_cbi_is_present')
            - name: Check CBI (Allow to fail) ('cros_cbi_contents_are_valid') (time:'3m0s')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: CBI is present ('cros_cbi_is_present')
                - name: UFS contains CBI contents ('cros_ufs_contains_cbi_contents')
              recoveries:
                - name: Recover and Validate CBI ('cros_cbi_contents_are_valid') (time:'3m0s')
                  conditions:
                    - name: Hardware write protection is disabled ('cros_is_hardware_write_protection_disabled')
                    - name: CBI is present ('cros_cbi_is_present')
                    - name: UFS contains CBI contents ('cros_ufs_contains_cbi_contents')
                  dependencies:
                    - name: Restore CBI contents from UFS ('cros_restore_cbi_contents_from_ufs')
                      dependencies:
                        - name: Hardware write protection is disabled ('cros_is_hardware_write_protection_disabled')
                        - name: CBI is present ('cros_cbi_is_present')
                        - name: UFS contains CBI contents ('cros_ufs_contains_cbi_contents')
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Invalidate CBI cache ('cros_invalidate_cbi_cache')
                      dependencies:
                        - name: CBI is present ('cros_cbi_is_present')
            - name: Update provisioned info ('cros_update_provision_info') (ALWAYS_RUN)
              recoveries:
                - name: Sleep 1s (Allow to fail) ('sample_sleep') (ALWAYS_RUN)
            - name: Is crosid readable ('cros_run_command')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Is crosid present ('cros_run_command')
              recoveries:
                - name: Repair by Reboot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Remove whitelabel_tag from vpd and reboot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Delete whitelabel_tag from vpd ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Simple reboot ('cros_run_command') (ALWAYS_RUN)
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Update special device labels ('sample_pass')
              dependencies:
                - name: Read device SKU (Allow to fail) ('cros_update_device_sku')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: dut_does_not_have_device_sku ('sample_fail')
                      conditions:
                        - name: dut_has_device_sku
                - name: Read Cr50 PHASE (Allow to fail) ('cros_update_cr50_label')
                  conditions:
                    - name: Is gsctool present on the host ('cros_run_shell_command')
                      dependencies:
                        - name: Read OS version ('cros_read_os_version')
                          dependencies:
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Read Cr50 key ID (Allow to fail) ('cros_update_cr50_key_id_label')
                  conditions:
                    - name: Is gsctool present on the host ('cros_run_shell_command')
                      dependencies:
                        - name: Read OS version ('cros_read_os_version')
                          dependencies:
                            - name: Internal storage is responsive ('cros_is_file_system_writable')
                              dependencies:
                                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Read if audio loopback present (Allow to fail) ('cros_update_audio_loopback_state_label')
                  conditions:
                    - name: Audio loopback state is not WORKING ('sample_fail')
                      conditions:
                        - name: cros_is_audio_loopback_state_working
                - name: Read dlm_sku_id (Allow to fail) ('cros_update_dlm_sku_id')
                  conditions:
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Update RO_VPD from DUT to Inventory ('cros_update_ro_vpd_inventory')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                      recoveries:
                        - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                          conditions:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                          dependencies:
                            - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                            - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                                  dependencies:
                                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Set fw_wp_state to force_off ('servo_set')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Servo USB-Key needs to be reflashed ('sample_pass')
                              conditions:
                                - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                              dependencies:
                                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                      dependencies:
                                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                          dependencies:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                              conditions:
                                                - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                                - name: Stable version image is missing from servo usbkey ('sample_fail')
                                  conditions:
                                    - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                              dependencies:
                                - name: servo_servod_echo_host
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                            - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                              conditions:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                              dependencies:
                                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                            - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                            - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Recovery version has OS image path ('has_stable_version_cros_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                            - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                            - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                              conditions:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                              dependencies:
                                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                            - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Reset power using servo if booted from USB ('sample_pass')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Collect dmesg logs from DUT (Allow to fail) ('cros_dmesg')
            - name: Verify bootId and compare ('cros_read_bootid')
              recoveries:
                - name: Quick provision OS ('sample_pass')
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                    - name: Internal storage is responsive ('cros_is_file_system_writable')
                      dependencies:
                        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  dependencies:
                    - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                    - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                  dependencies:
                    - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Validate chromebook X label (Allow to fail) ('cros_verify_cbx_matches_ufs')
              conditions:
                - name: Is Chromebook X supported ('cros_is_on_expected_version')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: cros_check_cbx_device_is_hb
              dependencies:
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                  recoveries:
                    - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                      conditions:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                      dependencies:
                        - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                        - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                              dependencies:
                                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Set fw_wp_state to force_off ('servo_set')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Servo USB-Key needs to be reflashed ('sample_pass')
                          conditions:
                            - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                          dependencies:
                            - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                                  dependencies:
                                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                      dependencies:
                                        - name: Setup has servo info ('dut_servo_host_present')
                                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                          conditions:
                                            - name: Setup has servo info ('dut_servo_host_present')
                                - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                                - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                            - name: Stable version image is missing from servo usbkey ('sample_fail')
                              conditions:
                                - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                          dependencies:
                            - name: servo_servod_echo_host
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                        - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                          conditions:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                          dependencies:
                            - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                        - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                        - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Recovery version has OS image path ('has_stable_version_cros_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                        - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                        - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                          conditions:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                          dependencies:
                            - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                        - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Reset power using servo if booted from USB ('sample_pass')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: All repair-requests resolved ('dut_has_no_repair_requests')
            - name: Reset DUT-state reason ('dut_reset_state_reason')
            - name: Servo is in WORKING state ('servo_match_state')
              conditions:
                - name: Pools require Servo in WORKING state ('dut_is_in_pool')
            - name: 'Set state: ready (''dut_set_state'') (RUN_ONCE)'
              dependencies:
                - name: All repair-requests resolved ('dut_has_no_repair_requests')
                - name: Reset DUT-state reason ('dut_reset_state_reason')
    - name: chameleon (Allow to fail)
      criticalactions:
        - name: Mark as bad ('chameleon_state_broken')
        - name: Device is pingable ('cros_ping') (time:'15s')
          recoveries:
            - name: Chameleon RPM power cycle ('sample_pass')
              conditions:
                - name: Has chameleon rpm info ('device_has_rpm_info')
              dependencies:
                - name: Power cycle chameleon by RPM ('device_rpm_power_cycle')
                - name: Wait for SSHable (after rpm cycle) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: cros_ssh
        - name: Update AudioBox JackPlugger State (Allow to fail) ('chameleon_check_audiobox_jackplugger')
        - name: Mark as good ('chameleon_state_working')
    - name: bluetooth_peer (Allow to fail)
      criticalactions:
        - name: 'Set state: BROKEN (''btpeer_state_broken'') (RUN_ONCE)'
        - name: Device is pingable ('cros_ping') (ALWAYS_RUN) (time:'15s')
        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN)
        - name: Fetch btpeer image release config from GCS ('btpeer_image_fetch_release_config') (RUN_ONCE)
        - name: OS image is up to date ('btpeer_image_assert_expected_installed')
          conditions:
            - name: Btpeer release process should be image-based ('btpeer_assert_release_process_matches') (RUN_ONCE)
          dependencies:
            - name: Identify expected image release ('btpeer_image_identify_expected') (RUN_ONCE)
            - name: Identify installed image release ('btpeer_image_fetch_installed_uuid') (ALWAYS_RUN)
          recoveries:
            - name: Provision OS to expected image release ('sample_pass') (ALWAYS_RUN)
              dependencies:
                - name: AB Partition device ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Device is not AB partitioned ('btpeer_has_partitions_with_labels') (ALWAYS_RUN)
                  dependencies:
                    - name: Verify device has space for new B partitions ('btpeer_has_partition_room') (ALWAYS_RUN)
                    - name: Verify device has standard partition scheme ('btpeer_device_has_standard_partitions') (ALWAYS_RUN)
                    - name: Enable initrd ('btpeer_enable_initrd') (ALWAYS_RUN) (time:'10m0s')
                    - name: Shrink rootfs ('btpeer_shrink_rootfs') (ALWAYS_RUN) (time:'16m40s')
                    - name: Disable initrd ('btpeer_disable_initrd') (ALWAYS_RUN) (time:'10m0s')
                    - name: Create new AB Partitions ('btpeer_partition_device') (ALWAYS_RUN) (time:'16m40s')
                - name: Temp Boot into A partition ('btpeer_temp_boot_into_partition') (ALWAYS_RUN) (time:'10m0s')
                  dependencies:
                    - name: Enable temp booting ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: btpeer_is_raspi_4b_less_than_revision_14
                      dependencies:
                        - name: btpeer_enable_debug_quirks
                        - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
                - name: Set permanent boot partition as A ('btpeer_set_permanent_boot_partition') (ALWAYS_RUN) (time:'10m0s')
                - name: Download expected OS image release to device ('btpeer_download_image') (ALWAYS_RUN) (time:'25m0s')
                - name: Flash B partitions with downloaded OS image ('btpeer_provision_device') (ALWAYS_RUN) (time:'40m0s')
                - name: Temp Boot into B partition ('btpeer_temp_boot_into_partition') (ALWAYS_RUN) (time:'10m0s')
                  dependencies:
                    - name: Enable temp booting ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: btpeer_is_raspi_4b_less_than_revision_14
                      dependencies:
                        - name: btpeer_enable_debug_quirks
                        - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
                - name: Set permanent boot partition as B ('btpeer_set_permanent_boot_partition') (ALWAYS_RUN) (time:'10m0s')
                - name: Verify newly installed image has an image UUID ('btpeer_image_fetch_installed_uuid') (ALWAYS_RUN)
        - name: Chameleond version is up to date ('sample_pass')
          conditions:
            - name: Btpeer release process should be chameleond-based ('btpeer_assert_release_process_matches') (RUN_ONCE)
          dependencies:
            - name: Fetch btpeer chameleond release config from GCS ('btpeer_fetch_btpeer_chameleond_release_config') (RUN_ONCE)
            - name: Identify expected chameleond release bundle ('btpeer_identify_expected_chameleond_release_bundle') (RUN_ONCE)
            - name: Fetch installed chameleond bundle commit from btpeer ('btpeer_fetch_installed_chameleond_bundle_commit') (ALWAYS_RUN)
              recoveries:
                - name: Install expected chameleond release bundle and then reboot device ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Install expected chameleond release bundle ('btpeer_install_expected_chameleond_release_bundle') (time:'15m0s')
                    - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
            - name: Btpeer has expected chameleond bundle installed ('btpeer_assert_btpeer_has_expected_chameleond_release_bundle_installed') (ALWAYS_RUN)
              recoveries:
                - name: Install expected chameleond release bundle and then reboot device ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Install expected chameleond release bundle ('btpeer_install_expected_chameleond_release_bundle') (time:'15m0s')
                    - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
        - name: Chameleond service is running ('btpeer_assert_chameleond_service_is_running') (ALWAYS_RUN)
          recoveries:
            - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
        - name: Device has been rebooted recently ('btpeer_assert_uptime_is_less_than_duration')
          recoveries:
            - name: Reboot device and wait for SSH ('btpeer_reboot') (ALWAYS_RUN) (time:'5m0s')
        - name: 'Set state: WORKING (''btpeer_state_working'') (RUN_ONCE)'
    - name: wifi_router (Allow to fail)
      criticalactions:
        - name: Set WifiRouter state to BROKEN ('wifi_router_set_state') (RUN_ONCE)
        - name: Device is ping-able ('cros_ping') (time:'15s')
        - name: Identify and set WifiRouter device_type ('wifi_router_identify_device_type')
        - name: Check ChromeOS Gale device ('sample_pass')
          conditions:
            - name: Is ChromeOS Gale ('wifi_router_device_type_in_list') (RUN_ONCE)
          dependencies:
            - name: Set Gale WifiRouter model and features ('wifi_router_update_model_and_features')
            - name: Device is on stable-version ('cros_is_on_stable_version')
              recoveries:
                - name: Provision Gale device to stable version ('cros_provision') (time:'1h0m0s')
            - name: Device has required wifi tools ('cros_is_tool_present')
              dependencies:
                - name: cros_ssh
              recoveries:
                - name: Provision Gale device to stable version ('cros_provision') (time:'1h0m0s')
            - name: Device has 50 percent tmp diskspace ('cros_has_enough_storage_space_percentage')
              recoveries:
                - name: Clean up tmp space ('cros_run_shell_command')
                  dependencies:
                    - name: Log usage report of tmp space (Allow to fail) ('wifi_router_log_usage_report_of_dir') (ALWAYS_RUN)
            - name: Device has 50 percent stateful partition diskspace ('cros_has_enough_storage_space_percentage')
              recoveries:
                - name: Clean up stateful sub space ('cros_run_shell_command')
                  dependencies:
                    - name: Log usage report of stateful partition diskspace (Allow to fail) ('wifi_router_log_usage_report_of_dir') (ALWAYS_RUN)
        - name: Check OpenWrt device ('sample_pass')
          conditions:
            - name: Is OpenWrt ('wifi_router_device_type_in_list') (RUN_ONCE)
          dependencies:
            - name: Fetch OpenWrt OS image build info from device ('wifi_router_openwrt_fetch_build_info')
            - name: Fetch OpenWrt image config from GCS ('wifi_router_openwrt_fetch_config') (RUN_ONCE)
            - name: Identify expected OS image for this OpenWrt device ('wifi_router_openwrt_identify_expected_image') (RUN_ONCE)
            - name: Device has expected OpenWrt OS image ('wifi_router_openwrt_has_expected_image')
              recoveries:
                - name: Update OpenWrt OS image with expected image ('wifi_router_openwrt_update_to_expected_image') (ALWAYS_RUN) (time:'10m0s')
                - name: Reboot then update OpenWrt OS image with expected image ('sample_pass')
                  dependencies:
                    - name: Reboot device ('wifi_router_reboot') (ALWAYS_RUN) (time:'3m20s')
                    - name: Update OpenWrt OS image with expected image ('wifi_router_openwrt_update_to_expected_image') (ALWAYS_RUN) (time:'10m0s')
            - name: Set WifiRouter model and features based on this OpenWrt device ('wifi_router_update_model_and_features')
        - name: Check AsusWrt device ('sample_pass')
          conditions:
            - name: Is AsusWrt ('wifi_router_device_type_in_list') (RUN_ONCE)
          dependencies:
            - name: Fetch model from AsusWrt device ('wifi_router_asuswrt_fetch_model')
            - name: Update model and features based on this AsusWrt device ('wifi_router_update_model_and_features')
        - name: Check Ubuntu device ('sample_pass')
          conditions:
            - name: Is Ubuntu ('wifi_router_device_type_in_list') (RUN_ONCE)
          dependencies:
            - name: Fetch system product name from Ubuntu device ('wifi_router_ubuntu_fetch_system_product_name')
            - name: Fetch network controller name from Ubuntu device ('wifi_router_ubuntu_fetch_network_controller_name')
            - name: Update model and features based on this Ubuntu device ('wifi_router_update_model_and_features')
        - name: Reboot device ('wifi_router_reboot') (ALWAYS_RUN) (time:'3m20s')
        - name: Set WifiRouter state to WORKING ('wifi_router_set_state') (RUN_ONCE)
    - name: human_motion_robot (Allow to fail)
      criticalactions:
        - name: Set state:BROKEN ('set_hmr_state') (time:'15s')
        - name: Device is pingable ('cros_ping') (time:'15s')
        - name: Device is sshable ('cros_ssh') (time:'1m0s')
        - name: Check HMR state with XMLRPC call GetErrors ('check_hmr_state')
        - name: Set state:WORKING ('set_hmr_state') (time:'15s')
    - name: dolos (Allow to fail)
      criticalactions:
        - name: Set state:BROKEN ('set_dolos_state')
        - name: Device is pingable ('cros_ping') (time:'15s')
        - name: Device is sshable ('cros_ssh') (time:'30s')
        - name: Set state:WORKING ('set_dolos_state')
    - name: close (Allow to fail)
      criticalactions:
        - name: Update peripheral wifi state (Allow to fail) ('update_peripheral_wifi_state')
        - name: Update wifi router features (Allow to fail) ('update_wifi_router_features')
        - name: Update chameleon state for chameleonless dut (Allow to fail) ('chameleon_state_not_applicable')
          conditions:
            - name: chameleon_not_present
        - name: Update DUT state based on servo state ('dut_set_state_reason')
          conditions:
            - name: DUT state is repair_failed ('dut_state_match')
            - name: Failure count are not above threshold ('sample_fail')
              dependencies:
                - name: Failure count above threshold ('metrics_check_task_failures')
                  conditions:
                    - name: Servo-host known ('dut_servo_host_present')
            - name: Servo-host known ('dut_servo_host_present')
            - name: Servo state demands manual repair ('dut_servo_state_required_manual_attention')
            - name: 'Set state: needs_manual_repair (Allow to fail) (''dut_set_state'') (ALWAYS_RUN)'
        - name: Update DUT state for failures more than threshold ('dut_set_state_reason')
          conditions:
            - name: DUT state is repair_failed ('dut_state_match')
            - name: Failure count above threshold ('metrics_check_task_failures')
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Failure count above threshold (Servo-less) ('metrics_check_task_failures')
              conditions:
                - name: No Servo-host ('sample_fail')
                  conditions:
                    - name: Servo-host known ('dut_servo_host_present')
            - name: 'Set state: needs_manual_repair (Allow to fail) (''dut_set_state'') (ALWAYS_RUN)'
        - name: Update cellular modem state for non-cellular pools (Allow to fail) ('set_cellular_modem_state')
          conditions:
            - name: Is not in cellular pool ('dut_not_in_pool_regex')
            - name: has_cellular_info
        - name: Close Servo-host (Allow to fail) ('sample_pass')
          conditions:
            - name: Servo-host known ('dut_servo_host_present')
            - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
            - name: Servo-host is sshable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
          dependencies:
            - name: Copy messages from servo-host (Allow to fail) ('cros_copy_to_logs')
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Copy eventlog.txt from servo-host (Allow to fail) ('cros_copy_to_logs')
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Collect dmesg logs from Servo-host (Allow to fail) ('cros_dmesg')
            - name: Collect servod logs (Allow to fail) ('cros_collect_servod_logs')
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Remove in-use flag on servo-host (Allow to fail) ('cros_remove_servo_in_use')
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Remove request to reboot if servo is good (Allow to fail) ('cros_remove_reboot_request')
              conditions:
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Servo-host known ('dut_servo_host_present')
                - name: Is servo_state:working ('servo_match_state')
            - name: Turn off servo usbkey power (Allow to fail) ('servo_set') (ALWAYS_RUN)
              conditions:
                - name: Servo-host known ('dut_servo_host_present')
            - name: Stop servod (Allow to fail) ('servo_host_servod_stop') (ALWAYS_RUN)
              dependencies:
                - name: Save UART capture (Allow to fail) ('servod_save_uart_capture')
                  dependencies:
                    - name: Stop UART capture (Allow to fail) ('servod_stop_uart_capture')
