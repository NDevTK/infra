plans:
    - name: cros_audit
      criticalactions:
        - name: 'Set state: needs_repair (''dut_set_state'') (ALWAYS_RUN)'
        - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
          recoveries:
            - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                  conditions:
                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                  dependencies:
                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                      conditions:
                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                  dependencies:
                    - name: servo_servod_echo_host
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
              conditions:
                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
              dependencies:
                - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
            - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Set fw_wp_state to force_off ('servo_set')
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
            - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                  conditions:
                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                  dependencies:
                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                      conditions:
                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                  dependencies:
                    - name: servo_servod_echo_host
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Servo USB-Key needs to be reflashed ('sample_pass')
                  conditions:
                    - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                  dependencies:
                    - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                  conditions:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Stable version image is missing from servo usbkey ('sample_fail')
                      conditions:
                        - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                  dependencies:
                    - name: servo_servod_echo_host
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                  dependencies:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Reset power using servo if booted from USB ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
              dependencies:
                - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
        - name: DUT has correct cros image version ('cros_is_on_stable_version')
          conditions:
            - name: Is it first deployment task ('sample_fail') (ALWAYS_RUN)
              conditions:
                - name: Is HWID known ('dut_has_hwid') (ALWAYS_RUN)
                - name: Is serial-number known ('dut_has_serial_number') (ALWAYS_RUN)
            - name: Recovery version has OS image path ('has_stable_version_cros_image')
              dependencies:
                - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
          dependencies:
            - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              recoveries:
                - name: Cold reset by servo and wait for SSH ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Install OS in recovery mode by booting from servo USB-drive (no storage check) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive (no storage check) ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Update FW from fw-image by servo and wait for boot ('sample_pass')
                  conditions:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                  dependencies:
                    - name: Flash EC (FW) by servo (allowed failed) (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                    - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                          dependencies:
                            - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                - name: Update fingerpprint FW from USB drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'16m40s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Set fw_wp_state to force_off ('servo_set')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in recovery mode by booting from servo USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Boot DUT in recovery and install from USB-drive ('cros_install_in_recovery_mode') (ALWAYS_RUN) (time:'2h13m20s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in recovery mode by booting from servo USB-drive (Flex) ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Servo USB-Key needs to be reflashed ('sample_pass')
                      conditions:
                        - name: It is time to update USB-drive image ('cros_is_time_to_force_download_image_to_usbkey')
                      dependencies:
                        - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Is servo USB key detected ('servo_usbkey_is_detected')
                              dependencies:
                                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                                  dependencies:
                                    - name: Setup has servo info ('dut_servo_host_present')
                                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                      conditions:
                                        - name: Setup has servo info ('dut_servo_host_present')
                            - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                            - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Download stable version OS image to servo usbkey if necessary (allow fail) (Allow to fail) ('sample_pass') (RUN_ONCE)
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                        - name: Stable version image is missing from servo usbkey ('sample_fail')
                          conditions:
                            - name: Servo usbkey has stable image ('servo_usbkey_has_stable_image')
                      dependencies:
                        - name: servo_servod_echo_host
                        - name: Is servo USB key detected ('servo_usbkey_is_detected')
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                        - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to DUT ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Print active devices (Allow to fail) ('cros_run_command') (ALWAYS_RUN)
                    - name: Is Flex booted from USB-drive ('cros_run_command') (ALWAYS_RUN)
                      conditions:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Run chromeos-install for Flex ('cros_run_command') (ALWAYS_RUN) (time:'10m0s')
                      dependencies:
                        - name: Is Flex device ('dut_check_board') (RUN_ONCE)
                    - name: Sleep 10 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'11s')
                    - name: Power OFF DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Direct USB-drive to servo host ('servo_set') (ALWAYS_RUN) (time:'20s')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Power ON DUT by servo ('servo_set') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Reset power using servo if booted from USB ('sample_pass')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
          recoveries:
            - name: Quick provision OS ('sample_pass')
              conditions:
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
                - name: Internal storage is responsive ('cros_is_file_system_writable')
                  dependencies:
                    - name: Device is SSHable ('cros_ssh') (ALWAYS_RUN) (time:'15s')
              dependencies:
                - name: Call provision for DUT ('cros_provision') (ALWAYS_RUN) (time:'1h0m0s')
                - name: Remove PROVISION repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode, with force to DEV-mode ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Set GBB flags to 0x18 by servo (Allow to fail) ('cros_set_gbb_by_servo') (time:'5m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode with fresh image ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Download stable image to USB-key (Allow to fail) ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                    - name: Call servod to download image to USB-key ('servo_download_image_to_usb') (ALWAYS_RUN) (time:'50m0s')
                    - name: Remove UPDATE_USBKEY_IMAGE repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
            - name: Install OS in DEV mode, with force to DEV-mode with test firmware ('sample_pass')
              conditions:
                - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                  dependencies:
                    - name: Setup has servo info ('dut_servo_host_present')
                    - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                      conditions:
                        - name: Setup has servo info ('dut_servo_host_present')
                - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                - name: Is servo USB key detected ('servo_usbkey_is_detected')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Recovery version has OS image path ('has_stable_version_cros_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                  dependencies:
                    - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
              dependencies:
                - name: Flash EC (FW) by servo ('cros_update_fw_with_fw_image_by_servo') (time:'1h50m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                - name: Disable software write protection via servo (Allow to fail) ('cros_disable_software_write_protection_by_servo') (time:'1m0s')
                  dependencies:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                - name: Flash AP (FW) with GBB 0x18 by servo (Allow to fail) ('cros_update_fw_with_fw_image_by_servo') (time:'1h30m0s')
                  conditions:
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Recovery version has firmware image path ('has_stable_version_fw_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                - name: Sleep 60 seconds (Allow to fail) ('sample_sleep') (ALWAYS_RUN) (time:'1m10s')
                - name: Install OS in DEV mode by USB-drive ('sample_pass') (ALWAYS_RUN)
                  conditions:
                    - name: Recovery version has OS image path ('has_stable_version_cros_image')
                      dependencies:
                        - name: Has a stable-version service ('has_stable_version_service_path') (RUN_ONCE)
                    - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                        - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                          conditions:
                            - name: Setup has servo info ('dut_servo_host_present')
                    - name: Is a Chromebook ('dut_check_board') (RUN_ONCE)
                    - name: Is servo USB key detected ('servo_usbkey_is_detected')
                      dependencies:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                  dependencies:
                    - name: Boot DUT from USB in DEV mode ('cros_dev_mode_boot_from_servo_usb_drive') (ALWAYS_RUN) (time:'10m50s')
                      dependencies:
                        - name: Setup has servo info ('dut_servo_host_present')
                    - name: Run install after boot from USB-drive ('cros_run_chromeos_install_command_after_boot_usbdrive') (ALWAYS_RUN) (time:'20m0s')
                    - name: Cold reset DUT by servo and wait to boot ('sample_pass') (ALWAYS_RUN)
                      conditions:
                        - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                          dependencies:
                            - name: Setup has servo info ('dut_servo_host_present')
                            - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                              conditions:
                                - name: Setup has servo info ('dut_servo_host_present')
                      dependencies:
                        - name: Cold reset DUT by servo ('servo_power_state_reset') (ALWAYS_RUN)
                          dependencies:
                            - name: Is servod running ('sample_pass') (ALWAYS_RUN)
                              dependencies:
                                - name: Setup has servo info ('dut_servo_host_present')
                                - name: Verify servod is responsive ('servod_echo') (ALWAYS_RUN) (time:'10s')
                                  conditions:
                                    - name: Setup has servo info ('dut_servo_host_present')
                        - name: Wait to be pingable (normal boot) ('cros_ping') (ALWAYS_RUN) (time:'2m30s')
                    - name: Wait to be SSHable (normal boot) ('cros_ssh') (ALWAYS_RUN) (time:'2m30s')
                    - name: Remove REIMAGE_BY_USBKEY repair-request ('dut_remove_repair_requests') (ALWAYS_RUN)
        - name: Audit storage (SMART only) (Allow to fail) ('cros_audit_storage_smart')
        - name: Audit device storage using badblocks (Allow to fail) ('cros_audit_storage_bad_blocks') (time:'1h40m0s')
