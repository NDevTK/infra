#!/bin/sh
# Copyright 2023 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# First `go install`s the necessary tools that we use to generate *.pb.go
# files from *.proto files.
set -eu
go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.30.0
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.3.0

# Then compile the protos. The working directory is assumed to be the
# root `reclient` directory.
protoc -I. -I$(go list -m -f '{{.Dir}}' github.com/bazelbuild/remote-apis-sdks) --go_out=. --go_opt=Mgo/api/command/command.proto=github.com/bazelbuild/remote-apis-sdks/go/api/command --go_opt=paths=source_relative api/**/*.proto
protoc -I. -I$(go list -m -f '{{.Dir}}' github.com/bazelbuild/remote-apis-sdks) --go-grpc_out=. --go-grpc_opt=Mgo/api/command/command.proto=github.com/bazelbuild/remote-apis-sdks/go/api/command --go-grpc_opt=paths=source_relative api/**/*.proto
