{
  "comments": [
    {
      "key": {
        "uuid": "77844d27_e7bc8e25",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1114299
      },
      "writtenOn": "2020-09-01T22:35:12Z",
      "side": 1,
      "message": "i find this CL risky:\n- it switch traffic to the new codepath 100% at once\n- the new codepath is not covered by tests\n- in case of a failure in the new code path, for all builds that went through the new codepath, they will get stuck until next deployment with the fix",
      "revId": "4cb0b60e508c59656d5d06306cfa105d8aac3dae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3dc792b7_fe964a7f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003211
      },
      "writtenOn": "2020-09-02T17:21:21Z",
      "side": 1,
      "message": "New code path seems trivial, 90% of the work is calling the existing code to export the build. You did not have tests for the more complex CronExportBuilds.\n\nAdding features like \"if it breaks route through the old code path\" (I don\u0027t know if this is what you\u0027re implying with your third point) will only complicate it.",
      "parentUuid": "77844d27_e7bc8e25",
      "revId": "4cb0b60e508c59656d5d06306cfa105d8aac3dae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a2e9569a_cea630f0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1114299
      },
      "writtenOn": "2020-09-02T17:25:04Z",
      "side": 1,
      "message": "\u003e New code path seems trivial, 90% of the work is calling the existing code to export the build. You did not have tests for the more complex CronExportBuilds.\n\nOnly two lines of code execute before _process_pull_task_batch() is called, which is tested. \n\n\u003e \n\u003e Adding features like \"if it breaks route through the old code path\" (I don\u0027t know if this is what you\u0027re implying with your third point) will only complicate it.\n\ni didn\u0027t mean that. Can you at least send only 10% of the traffic to the push queue, while the rest still goes to the pull queue?",
      "parentUuid": "3dc792b7_fe964a7f",
      "revId": "4cb0b60e508c59656d5d06306cfa105d8aac3dae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26992370_c9e5b272",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003211
      },
      "writtenOn": "2020-09-02T18:08:57Z",
      "side": 1,
      "message": "The logic is more complex. You have a loop with multiple exit conditions. My code just calls three tested functions in serial.\n\nAt any rate, fine. I\u0027ve removed the change which changes push -\u003e pull but I\u0027ve left the new handler. I\u0027ll release this, which is a no op, then in a follow up I\u0027ll do the push -\u003e pull conversion, and we can tune it using GAE traffic splitting. That way GAE split decides whether to enqueue push or pull and whichever side of the split is asked to handle the push task will have the handler code.",
      "parentUuid": "a2e9569a_cea630f0",
      "revId": "4cb0b60e508c59656d5d06306cfa105d8aac3dae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fed27089_6b09b676",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1114299
      },
      "writtenOn": "2020-09-02T18:55:26Z",
      "side": 1,
      "message": "the code after _process_pull_task_batch in the cron job does not matter from the risk perspective. It is just an optimization. If it crashes, _process_pull_task_batch() will be called again in a minute by cron.",
      "parentUuid": "26992370_c9e5b272",
      "revId": "4cb0b60e508c59656d5d06306cfa105d8aac3dae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}