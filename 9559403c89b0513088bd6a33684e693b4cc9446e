{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "80064066_4056d981",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1161844
      },
      "writtenOn": "2022-11-29T22:37:21Z",
      "side": 1,
      "message": "vadimsh for go.mod review, and possible consideration for integrating opentelemetry into LUCI libs.",
      "revId": "9559403c89b0513088bd6a33684e693b4cc9446e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2944ee37_7ecfafeb",
        "filename": "go/src/infra/appengine/drone-queen/appengine/main.go",
        "patchSetId": 11
      },
      "lineNbr": 50,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2022-11-29T22:51:52Z",
      "side": 1,
      "message": "It does this only on fatal errors during startup (i.e. same as calling https://pkg.go.dev/log#Fatal). Defers would run no normal graceful shutdown. But doing it through RegisterCleanup is still nicer, since it will get a proper context.Context.",
      "range": {
        "startLine": 47,
        "startChar": 2,
        "endLine": 50,
        "endChar": 16
      },
      "revId": "9559403c89b0513088bd6a33684e693b4cc9446e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff88d618_95b9ebe4",
        "filename": "go/src/infra/appengine/drone-queen/appengine/main.go",
        "patchSetId": 11
      },
      "lineNbr": 53,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2022-11-29T22:51:52Z",
      "side": 1,
      "message": "this is context.Background(), this logging will do absolutely nothing\n\nIt is better to do initialization inside server.Main callback. The context there is srv.Context and it is already sufficiently initialized to support logging, authentication, etc etc.\n\nIt would also allow to simplify code a little bit:\n\n```\nserver.Main(.... func(...) ... {\n  exp, err :\u003d ...\n  if err !\u003d nil {\n    return err\n  }\n  tp :\u003d ...\n  srv.RegisterCleanup(func(ctx context.Context) {\n    if err :\u003d tp.Shutdown(ctx); err !\u003d nil {\n      logging.Error(ctx, ...)\n    }\n  })\n  \n  ...\n})\n```\n\n(i.e. no need to do type casts etc, just shutdown whatever was initialized)",
      "range": {
        "startLine": 53,
        "startChar": 16,
        "endLine": 53,
        "endChar": 19
      },
      "revId": "9559403c89b0513088bd6a33684e693b4cc9446e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}