{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "de209705_70168426",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 104,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-05-27T01:12:15Z",
      "side": 1,
      "message": "I think it\u0027d be clear if we mention in a comment that one is a list of inline variants and the other is the out-of-line variants name.",
      "range": {
        "startLine": 102,
        "startChar": 1,
        "endLine": 104,
        "endChar": 1
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1c7b0c11_67d44859",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 104,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T18:55:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "de209705_70168426",
      "range": {
        "startLine": 102,
        "startChar": 1,
        "endLine": 104,
        "endChar": 1
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "054e5e21_94725888",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 597,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-05-27T01:12:15Z",
      "side": 1,
      "message": "I don\u0027t get it. Nothing is filled at this point. Why bother expanding all the histograms we\u0027re going to return an empty list when globalMessage is set to true?",
      "range": {
        "startLine": 595,
        "startChar": 1,
        "endLine": 597,
        "endChar": 2
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c151324f_b04ece51",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 597,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T18:55:01Z",
      "side": 1,
      "message": "updateHistogramStatus will update histogramStatus, so we still need the expansions. I\u0027ll remove CL-level obsoletion message code to a separate CL to make it less confusing :)",
      "parentUuid": "054e5e21_94725888",
      "range": {
        "startLine": 595,
        "startChar": 1,
        "endLine": 597,
        "endChar": 2
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a55c9ed5_1b763961",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 597,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-06-02T01:47:24Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "c151324f_b04ece51",
      "range": {
        "startLine": 595,
        "startChar": 1,
        "endLine": 597,
        "endChar": 2
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ebec7ba_245ac8e0",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 669,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-05-27T01:12:15Z",
      "side": 1,
      "message": "Why check discontinuity here?",
      "range": {
        "startLine": 667,
        "startChar": 2,
        "endLine": 669,
        "endChar": 3
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c733dbae_83ac1d95",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 669,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T18:55:01Z",
      "side": 1,
      "message": "so I see you added a test in https://chromium-review.googlesource.com/c/infra/infra/+/4494283 with a test including a comment \"Remove an already deprecated histogram shouldn\u0027t show a Tricium warning.\", it was passing but it\u0027s because the test itself is flawed (sorry the test set-up wasn\u0027t super clear).\n\nSo what was happening was when removing a deprecated histogram without a obsoletion message there would be a Tricium warning, which based on the comment I thought you didn\u0027t want.\n\nI guess I\u0027m not entirely sure what deprecated means here, so I just decided to check discontinuity, but now I think about it maybe I should just check if the histogram has already expired?",
      "parentUuid": "2ebec7ba_245ac8e0",
      "range": {
        "startLine": 667,
        "startChar": 2,
        "endLine": 669,
        "endChar": 3
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b8f4ae1_51c8d53d",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 669,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-06-02T00:15:05Z",
      "side": 1,
      "message": "Actually now I think about this, did you mean a warning for data discontinuity won\u0027t show? I think I understood wrong o_O",
      "parentUuid": "c733dbae_83ac1d95",
      "range": {
        "startLine": 667,
        "startChar": 2,
        "endLine": 669,
        "endChar": 3
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "060543c9_63f5f9a2",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 669,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-06-02T01:47:24Z",
      "side": 1,
      "message": "\u003e So what was happening was when removing a deprecated histogram without a obsoletion message there would be a Tricium warning, which based on the comment I thought you didn\u0027t want.\n\n\nActually, I was wrong in the name of the test. There should be *no* Data discontinuity Tricium warning at all when removing an already expired histogram regardless of the obsolete message. (The obsolete message means an \u003cobsolete\u003e tag in the histogram entry).\n\nSo a data discontinuity message should be shown when an already long expired histogram is revived. Removing a histogram (regardless of the obsolete) / Adding a new histogram / Extending an about to expire histogram should not see this warning.\n\nSo, let\u0027s do it step by step here: What exactly do you want to achieve?\n\nAssuming you don\u0027t skip any expired histograms:\n\n1. You\u0027re expanding the histogram here both the new ones and the old ones. \n2. You get the difference between the old histograms and the new histograms to get all histograms that were removed from this cl (including generated ones).\n3. For each of them, check if they are in the |obsoleteHistograms| set (I don\u0027t know what this is but I assume you know)\n4. If a histogram is removed but it\u0027s not in the |obsoleteHistograms|, show a file level Tricium message for each of them.\n\nI didn\u0027t look at the code detail just yet but can you confirm with the above?\n\nIf so, now, let\u0027s consider obsolete patterned histograms.\n\nIf a patterned histogram is already expired or already marked as obsolete and a user just want to clean them up in the cl, what do you want them to do? Do you require them to put an obsolete message? Do you want to show the warning?\n\n------------------------------------------\n\nNow, let\u0027s come back to why checking discontinuity is inappropriate here. When checkDiscontinuity is true, that means a histogram is expired by 30 days. But why should we stop expanding them? Or what if a histogram is expired for just 2 days (so it\u0027s technically expired but just expired), do you want to expand it?",
      "parentUuid": "0b8f4ae1_51c8d53d",
      "range": {
        "startLine": 667,
        "startChar": 2,
        "endLine": 669,
        "endChar": 3
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93af4f50_2148b74e",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check.go",
        "patchSetId": 12
      },
      "lineNbr": 669,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-06-06T03:13:03Z",
      "side": 1,
      "message": "\u003e I didn\u0027t look at the code detail just yet but can you confirm with the above?\n\nIt\u0027s mostly right except a few details (assuming we don\u0027t skip any expired histograms):\n1. The returned list of histograms after the expansion doesn\u0027t include those that are already obsolete. Because it doesn\u0027t make sense to ask people to add another obsoletion message in that case.\n2. If the histogram is removed and present in |obsoleteHistograms|, it will be removed from |obsoleteHistograms|. I explained why we do it in another thread.\n\n\n\u003e If a patterned histogram is already expired or already marked as obsolete and a user just want to clean them up in the cl, what do you want them to do? Do you require them to put an obsolete message? Do you want to show the warning?\n\nI think I don\u0027t want to ask them to add an obsoletion message if the histogram is already expired, because the obvious reason would be \"the histogram expired\". So I think I want expired histograms to have the same treatment as obsolete histograms, we just ignore them when we are analyzing for obsoletion message related issues.\n\n\u003e Or what if a histogram is expired for just 2 days (so it\u0027s technically expired but just expired), do you want to expand it?\n\nNo, I think for all expired histograms we shouldn\u0027t expand them. I agree using checkDiscontinuity() isn\u0027t appropriate in this case. I\u0027ll modify checkDiscontinuity to take a parameter and rename it.",
      "parentUuid": "060543c9_63f5f9a2",
      "range": {
        "startLine": 667,
        "startChar": 2,
        "endLine": 669,
        "endChar": 3
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e36bab8_57ce5c8d",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check_test.go",
        "patchSetId": 12
      },
      "lineNbr": 624,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-05-27T01:12:15Z",
      "side": 1,
      "message": "Data discontinuity doesn\u0027t mean the histogram is expired. It\u0027s technically the same as users add a new histogram whose name used to exist. But the point is, it\u0027s a newly added histogram so it should definitely be checked.",
      "range": {
        "startLine": 624,
        "startChar": 78,
        "endLine": 624,
        "endChar": 119
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36abe1a8_79f688b1",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check_test.go",
        "patchSetId": 12
      },
      "lineNbr": 624,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T18:55:01Z",
      "side": 1,
      "message": "sorry for the confusion, I guess I messed these two terms up and wasn\u0027t being clear in the test description. We do still check the newly added histogram (in analyzeChangedLines). We just don\u0027t show an info to add an obsoletion message if a histogram with discontinuity was removed, for details see my reply to the previous comment.",
      "parentUuid": "0e36bab8_57ce5c8d",
      "range": {
        "startLine": 624,
        "startChar": 78,
        "endLine": 624,
        "endChar": 119
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c467036_f397df81",
        "filename": "go/src/infra/tricium/functions/metrics/histograms_check_test.go",
        "patchSetId": 12
      },
      "lineNbr": 624,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-06-02T01:47:24Z",
      "side": 1,
      "message": "Replied in the other thread. I\u0027ll take another look at this cl once I understand what you\u0027re trying to achieve here.",
      "parentUuid": "36abe1a8_79f688b1",
      "range": {
        "startLine": 624,
        "startChar": 78,
        "endLine": 624,
        "endChar": 119
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dac22f93_7ff6bbf2",
        "filename": "go/src/infra/tricium/functions/metrics/metrics_analyzer.go",
        "patchSetId": 12
      },
      "lineNbr": 65,
      "author": {
        "id": 1294186
      },
      "writtenOn": "2023-05-27T01:12:15Z",
      "side": 1,
      "message": "I\u0027m still not quite understand what the global obsolete message mean but I would suggest we spilt it into two different cls as I feel it has nothing to do with the patterned histograms support here and you don\u0027t have a unit test for it.",
      "range": {
        "startLine": 65,
        "startChar": 1,
        "endLine": 65,
        "endChar": 29
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63db491d_882d9ac7",
        "filename": "go/src/infra/tricium/functions/metrics/metrics_analyzer.go",
        "patchSetId": 12
      },
      "lineNbr": 65,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T18:55:01Z",
      "side": 1,
      "message": "I\u0027ll move the changes to a separate CL.\n\nWe do have unit test for it, the description is \"Analyze XML file with histogram(s) removed with a global message\"",
      "parentUuid": "dac22f93_7ff6bbf2",
      "range": {
        "startLine": 65,
        "startChar": 1,
        "endLine": 65,
        "endChar": 29
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "100808b1_fd64db64",
        "filename": "go/src/infra/tricium/functions/metrics/metrics_analyzer.go",
        "patchSetId": 12
      },
      "lineNbr": 65,
      "author": {
        "id": 1554177
      },
      "writtenOn": "2023-05-29T22:25:07Z",
      "side": 1,
      "message": "Just realize I forgot to add, global obsoletion message is a message that applies to all histograms removed in the CL, it will be overridden by explicit obsoletion messages and will ignore obsolete or deprecated histograms (can be easily changed if it\u0027s not a good idea).",
      "parentUuid": "63db491d_882d9ac7",
      "range": {
        "startLine": 65,
        "startChar": 1,
        "endLine": 65,
        "endChar": 29
      },
      "revId": "9c8f14d5783d76c12281de3415879696e0cd020a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}