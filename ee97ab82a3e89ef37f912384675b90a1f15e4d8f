{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "42a91621_985e0448",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157909
      },
      "writtenOn": "2022-01-10T19:18:33Z",
      "side": 1,
      "message": "PTAL",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "667e4fe1_0ef6d67a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2022-01-11T08:01:43Z",
      "side": 1,
      "message": "+vadim too",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0371c3e_cd04317b",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2022-01-11T01:44:44Z",
      "side": 1,
      "message": "if you look at the definition of `generate`, it allows embedding some data: https://source.chromium.org/chromium/infra/infra/+/main:luci/appengine/components/components/auth/tokens.py;l\u003d84?q\u003dTokenKind\u0026ss\u003dchromium\n\nI think that would probably be a better mechanism than manually tweaking the token format.",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc984954_1e008aa3",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1157909
      },
      "writtenOn": "2022-01-11T02:39:10Z",
      "side": 1,
      "message": "I used embedded initially and decided not to, because I couldn\u0027t figure out the value of \"state\" to pass to [1]. Do we save the state somewhere?\n\n[1]: https://source.chromium.org/chromium/infra/infra/+/main:go/src/go.chromium.org/luci/server/tokens/tokens.go;l\u003d142;drc\u003deae489f926427b8a756f47946ce5d5d161612cde",
      "parentUuid": "a0371c3e_cd04317b",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "916d0ba2_4920bd8a",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2022-01-11T08:01:43Z",
      "side": 1,
      "message": "I think this is a feature of the Go impl of server tokens\u0027 Generate (https://source.chromium.org/chromium/infra/infra/+/main:go/src/go.chromium.org/luci/server/tokens/tokens.go;l\u003d76;drc\u003deae489f926427b8a756f47946ce5d5d161612cde).\n\nIn our case it would be nil (the Buildbucket token dosen\u0027t have any additional state to it).\n\nHowever, the fact that we\u0027re generating with a \"message\" of build_id (which is excluded from the MAC), but then also embedding build_id in the generated token, gives me a spooky vibes. I can\u0027t think of a reason why this would be bad in this specific context, however (since the actual key is always secret). Vadim are we about to do something exceptionally bad here?",
      "parentUuid": "cc984954_1e008aa3",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78760edb_369add1f",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2022-01-11T08:03:31Z",
      "side": 1,
      "message": "Oh, actually, \u0027state\u0027 here is the same as message (i.e. the build id). The terminology just changed between python and go.",
      "parentUuid": "916d0ba2_4920bd8a",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98456c82_be487473",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2022-01-11T08:05:22Z",
      "side": 1,
      "message": "Actually; I think it would be fine to change the token so that \u0027message\u0027 is empty (i.e. just move the data from `message` to `embedded`). There may be a migration issue for that, however (so we\u0027d need to change the validation code to first try a nil state, followed by a buildid state in the interim)",
      "parentUuid": "78760edb_369add1f",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e803bc37_e6b72ad3",
        "filename": "appengine/cr-buildbucket/tokens.py",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1157909
      },
      "writtenOn": "2022-01-11T22:35:37Z",
      "side": 1,
      "message": "Ah got it. Thanks for the info. Done.",
      "parentUuid": "98456c82_be487473",
      "revId": "ee97ab82a3e89ef37f912384675b90a1f15e4d8f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}